"use strict";function asyncGeneratorStep(e,t,n,r,a,s,i){try{var c=e[s](i),o=c.value}catch(e){return void n(e)}c.done?t(o):Promise.resolve(o).then(r,a)}function _asyncToGenerator(c){return function(){var e=this,i=arguments;return new Promise(function(t,n){var r=c.apply(e,i);function a(e){asyncGeneratorStep(r,t,n,a,s,"next",e)}function s(e){asyncGeneratorStep(r,t,n,a,s,"throw",e)}a(void 0)})}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}var Chat=function(){function r(e,t,n){_classCallCheck(this,r),this.pub_key="pub_3e2a6723918cf08da95fb5051533f9bd",this.sub_key="sub_64e816e612f61f67cb25467043520eb8",this.clientid=t,this.isready=!1,this.chatName=e,this.callback=n,ROP.Enter(this.pub_key,this.sub_key,this.clientid)}var t;return _createClass(r,[{key:"enter",value:function(){var n=this;return new Promise(function(e,t){ROP.On("enter_suc",function(){console.log("链接成功"),n.isready=!0,e("success")}),ROP.On("enter_fail",function(e){n.isready=!1,t(e)})})}},{key:"getmsg",value:function(){var n=this;ROP.On("publish_data",function(e,t){"function"==typeof n.callback&&(console.log("收到消息话题"+t+" ->消息 "+e),n.callback({topic:t,data:e}))})}},{key:"sub",value:function(e){ROP.Subscribe(e),console.log("已关注话题:"+e)}},{key:"unsub",value:function(e){ROP.UnSubscribe(e)}},{key:"push",value:(t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isready){e.next=10;break}return e.next=3,this.enter();case 3:if("success"!=e.sent){e.next=8;break}this.sub(this.chatName),e.next=10;break;case 8:return console.log("ready失败"),e.abrupt("return");case 10:if(!this.isready){e.next=15;break}if(""==this.chatName)return console.log("chatName为空"),e.abrupt("return");e.next=14;break;case 14:t&&(console.log("发送消息"+t),ROP.Publish(t,this.chatName));case 15:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})}]),r}();